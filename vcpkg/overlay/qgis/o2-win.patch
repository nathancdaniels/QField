From cd4f29a6ddfa37816a5ee7f5346904b91b62a610 Mon Sep 17 00:00:00 2001
From: Matthias Kuhn <matthias@opengis.ch>
Date: Sun, 14 Nov 2021 19:56:21 +0100
Subject: [PATCH] [o2] fix static linking on windows

https://github.com/pipacs/o2/commit/1f9604edbddfadc323ec7801e625a846e262fc59
---
 external/o2/src/CMakeLists.txt | 4 ++++
 external/o2/src/o0export.h     | 4 ++--
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/external/o2/src/CMakeLists.txt b/external/o2/src/CMakeLists.txt
index 006d500de6..eadab8cd70 100644
--- a/external/o2/src/CMakeLists.txt
+++ b/external/o2/src/CMakeLists.txt
@@ -192,6 +192,10 @@ endif(BUILD_SHARED_LIBS AND APPLE AND POLICY CMP0042)
 
 add_library( o2 ${o2_SRCS} ${o2_HDRS} )
 
+if(BUILD_SHARED_LIBS)
+ï¿¼    add_definitions( -DO2_SHARED_LIB )
+endif(BUILD_SHARED_LIBS)
+
 if(o2_WITH_QT5)
     target_link_libraries( o2 Qt5::Core Qt5::Network ${LINK_TARGETS})
 else(o2_WITH_QT5)
diff --git a/external/o2/src/o0export.h b/external/o2/src/o0export.h
index 5af45cbb6f..dc33f49257 100644
--- a/external/o2/src/o0export.h
+++ b/external/o2/src/o0export.h
@@ -1,7 +1,7 @@
 #pragma once
 
 // For exporting symbols from Windows' DLLs
-#ifdef _WIN32
+#if defined (_WIN32) && defined(O2_SHARED_LIB)
     #ifdef O2_DLL_EXPORT
         #define O0_EXPORT __declspec(dllexport)
     #else
@@ -9,4 +9,4 @@
     #endif
 #else
     #define O0_EXPORT
-#endif
\ No newline at end of file
+#endif
-- 
2.31.1

